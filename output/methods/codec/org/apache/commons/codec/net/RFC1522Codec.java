protected String encodeText(final String text, final String charset) throws EncoderException, UnsupportedEncodingException { [EOL]     if (text == null) { [EOL]         return null; [EOL]     } [EOL]     StringBuffer buffer = new StringBuffer(); [EOL]     buffer.append("=?"); [EOL]     buffer.append(charset); [EOL]     buffer.append('?'); [EOL]     buffer.append(getEncoding()); [EOL]     buffer.append('?'); [EOL]     byte[] rawdata = doEncoding(text.getBytes(charset)); [EOL]     buffer.append(new String(rawdata, CharacterEncodingNames.US_ASCII)); [EOL]     buffer.append("?="); [EOL]     return buffer.toString(); [EOL] } <line_num>: 66,82
protected String decodeText(final String text) throws DecoderException, UnsupportedEncodingException { [EOL]     if (text == null) { [EOL]         return null; [EOL]     } [EOL]     if ((!text.startsWith("=?")) || (!text.endsWith("?="))) { [EOL]         throw new DecoderException("RFC 1522 violation: malformed encoded content"); [EOL]     } [EOL]     int termnator = text.length() - 2; [EOL]     int from = 2; [EOL]     int to = text.indexOf("?", from); [EOL]     if ((to == -1) || (to == termnator)) { [EOL]         throw new DecoderException("RFC 1522 violation: charset token not found"); [EOL]     } [EOL]     String charset = text.substring(from, to); [EOL]     if (charset.equals("")) { [EOL]         throw new DecoderException("RFC 1522 violation: charset not specified"); [EOL]     } [EOL]     from = to + 1; [EOL]     to = text.indexOf("?", from); [EOL]     if ((to == -1) || (to == termnator)) { [EOL]         throw new DecoderException("RFC 1522 violation: encoding token not found"); [EOL]     } [EOL]     String encoding = text.substring(from, to); [EOL]     if (!getEncoding().equalsIgnoreCase(encoding)) { [EOL]         throw new DecoderException("This codec cannot decode " + encoding + " encoded content"); [EOL]     } [EOL]     from = to + 1; [EOL]     to = text.indexOf("?", from); [EOL]     byte[] data = text.substring(from, to).getBytes(CharacterEncodingNames.US_ASCII); [EOL]     data = doDecoding(data); [EOL]     return new String(data, charset); [EOL] } <line_num>: 97,131
protected abstract String getEncoding(); <line_num>: 138,138
protected abstract byte[] doEncoding(byte[] bytes) throws EncoderException; <line_num>: 150,150
protected abstract byte[] doDecoding(byte[] bytes) throws DecoderException; <line_num>: 162,162
