public CrossModuleMethodMotionTest() { [EOL]     super(EXTERNS); [EOL] } <line_num>: 33,35
@Override [EOL] protected CompilerPass getProcessor(Compiler compiler) { [EOL]     return new CrossModuleMethodMotion(compiler, new CrossModuleMethodMotion.IdGenerator(), canMoveExterns); [EOL] } <line_num>: 37,41
@Override [EOL] public void setUp() { [EOL]     super.enableLineNumberCheck(true); [EOL]     canMoveExterns = false; [EOL] } <line_num>: 43,47
public void testMovePrototypeMethod1() { [EOL]     testSame(createModuleChain("function Foo() {}" + "Foo.prototype.bar = function() {};", "(new Foo).bar()")); [EOL]     canMoveExterns = true; [EOL]     test(createModuleChain("function Foo() {}" + "Foo.prototype.bar = function() {};", "(new Foo).bar()"), new String[] { STUB_DECLARATIONS + "function Foo() {}" + "Foo.prototype.bar = JSCompiler_stubMethod(0);", "Foo.prototype.bar = JSCompiler_unstubMethod(0, function() {});" + "(new Foo).bar()" }); [EOL] } <line_num>: 49,70
public void testMovePrototypeMethod2() { [EOL]     test(createModuleChain("function Foo() {}" + "Foo.prototype = { method: function() {} };", "(new Foo).method()"), new String[] { STUB_DECLARATIONS + "function Foo() {}" + "Foo.prototype = { method: JSCompiler_stubMethod(0) };", "Foo.prototype.method = " + "    JSCompiler_unstubMethod(0, function() {});" + "(new Foo).method()" }); [EOL] } <line_num>: 72,87
public void testMovePrototypeMethod3() { [EOL]     testSame(createModuleChain("function Foo() {}" + "Foo.prototype = { get method() {} };", "(new Foo).method()")); [EOL] } <line_num>: 89,95
public void testMovePrototypeRecursiveMethod() { [EOL]     test(createModuleChain("function Foo() {}" + "Foo.prototype.baz = function() { this.baz(); };", "(new Foo).baz()"), new String[] { STUB_DECLARATIONS + "function Foo() {}" + "Foo.prototype.baz = JSCompiler_stubMethod(0);", "Foo.prototype.baz = JSCompiler_unstubMethod(0, " + "    function() { this.baz(); });" + "(new Foo).baz()" }); [EOL] } <line_num>: 97,112
public void testCantMovePrototypeProp() { [EOL]     testSame(createModuleChain("function Foo() {}" + "Foo.prototype.baz = goog.nullFunction;", "(new Foo).baz()")); [EOL] } <line_num>: 114,120
public void testMoveMethodsInRightOrder() { [EOL]     test(createModuleChain("function Foo() {}" + "Foo.prototype.baz = function() { return 1; };" + "Foo.prototype.baz = function() { return 2; };", "(new Foo).baz()"), new String[] { STUB_DECLARATIONS + "function Foo() {}" + "Foo.prototype.baz = JSCompiler_stubMethod(1);" + "Foo.prototype.baz = JSCompiler_stubMethod(0);", "Foo.prototype.baz = " + "JSCompiler_unstubMethod(1, function() { return 1; });" + "Foo.prototype.baz = " + "JSCompiler_unstubMethod(0, function() { return 2; });" + "(new Foo).baz()" }); [EOL] } <line_num>: 122,141
public void testMoveMethodsInRightOrder2() { [EOL]     JSModule[] m = createModules("function Foo() {}" + "Foo.prototype.baz = function() { return 1; };" + "function Goo() {}" + "Goo.prototype.baz = function() { return 2; };", "", "(new Foo).baz()", "", "(new Goo).baz()"); [EOL]     m[1].addDependency(m[0]); [EOL]     m[2].addDependency(m[1]); [EOL]     m[3].addDependency(m[2]); [EOL]     m[4].addDependency(m[2]); [EOL]     test(m, new String[] { STUB_DECLARATIONS + "function Foo() {}" + "Foo.prototype.baz = JSCompiler_stubMethod(1);" + "function Goo() {}" + "Goo.prototype.baz = JSCompiler_stubMethod(0);", "", "Foo.prototype.baz = " + "JSCompiler_unstubMethod(1, function() { return 1; });" + "Goo.prototype.baz = " + "JSCompiler_unstubMethod(0, function() { return 2; });" + "(new Foo).baz()", "", "(new Goo).baz()" }); [EOL] } <line_num>: 143,183
public void testMoveMethodsUsedInTwoModules() { [EOL]     testSame(createModuleStar("function Foo() {}" + "Foo.prototype.baz = function() {};", "(new Foo).baz()", "(new Foo).baz()")); [EOL] } <line_num>: 185,193
public void testMoveMethodsUsedInTwoModules2() { [EOL]     JSModule[] modules = createModules("function Foo() {}" + "Foo.prototype.baz = function() {};", "", "(new Foo).baz() + 1", "(new Foo).baz() + 2"); [EOL]     modules[1].addDependency(modules[0]); [EOL]     modules[2].addDependency(modules[1]); [EOL]     modules[3].addDependency(modules[1]); [EOL]     test(modules, new String[] { STUB_DECLARATIONS + "function Foo() {}" + "Foo.prototype.baz = JSCompiler_stubMethod(0);", "Foo.prototype.baz = JSCompiler_unstubMethod(0, function() {});", "(new Foo).baz() + 1", "(new Foo).baz() + 2" }); [EOL] } <line_num>: 195,221
public void testTwoMethods() { [EOL] } <line_num>: 223,223
public void testTwoMethods2() { [EOL]     test(createModuleChain("function Foo() {}" + "Foo.prototype.baz = function() {};", "(new Foo).callBaz()", "Foo.prototype.callBaz = function() { this.baz(); }"), new String[] { STUB_DECLARATIONS + "function Foo() {}" + "Foo.prototype.baz = JSCompiler_stubMethod(0);", "(new Foo).callBaz()", "Foo.prototype.baz = JSCompiler_unstubMethod(0, function() {});" + "Foo.prototype.callBaz = function() { this.baz(); };" }); [EOL] } <line_num>: 247,267
public void testGlobalFunctionsInGraph() { [EOL]     test(createModuleChain("function Foo() {}" + "Foo.prototype.baz = function() {};" + "function x() { return (new Foo).baz(); }", "x();"), new String[] { STUB_DECLARATIONS + "function Foo() {}" + "Foo.prototype.baz = JSCompiler_stubMethod(0);" + "function x() { return (new Foo).baz(); }", "Foo.prototype.baz = JSCompiler_unstubMethod(0, function() {});" + "x();" }); [EOL] } <line_num>: 269,285
public void testClosureVariableReads1() { [EOL]     testSame(createModuleChain("function Foo() {}" + "(function() {" + "var x = 'x';" + "Foo.prototype.baz = function() {x};" + "})();", "var y = new Foo(); y.baz();")); [EOL] } <line_num>: 288,297
public void testClosureVariableReads2() { [EOL]     test(createModuleChain("function Foo() {}" + "Foo.prototype.b1 = function() {" + "  var x = 1;" + "  Foo.prototype.b2 = function() {" + "    Foo.prototype.b3 = function() {" + "      x;" + "    }" + "  }" + "};", "var y = new Foo(); y.b1();", "y = new Foo(); z.b2();", "y = new Foo(); z.b3();"), new String[] { STUB_DECLARATIONS + "function Foo() {}" + "Foo.prototype.b1 = JSCompiler_stubMethod(0);", "Foo.prototype.b1 = JSCompiler_unstubMethod(0, function() {" + "  var x = 1;" + "  Foo.prototype.b2 = function() {" + "    Foo.prototype.b3 = function() {" + "      x;" + "    }" + "  }" + "});" + "var y = new Foo(); y.b1();", "y = new Foo(); z.b2();", "y = new Foo(); z.b3();" }); [EOL] } <line_num>: 300,337
public void testClosureVariableReads3() { [EOL] } <line_num>: 339,339
public void testNoClosureVariableReads1() { [EOL]     test(createModuleChain("function Foo() {}" + "var x = 'x';" + "Foo.prototype.baz = function(){x};", "var y = new Foo(); y.baz();"), new String[] { STUB_DECLARATIONS + "function Foo() {}" + "var x = 'x';" + "Foo.prototype.baz = JSCompiler_stubMethod(0);", "Foo.prototype.baz = JSCompiler_unstubMethod(0, function(){x});" + "var y = new Foo(); y.baz();" }); [EOL] } <line_num>: 382,398
public void testNoClosureVariableReads2() { [EOL]     test(createModuleChain("function Foo() {}" + "Foo.prototype.baz = function(){var x = 1;x};", "var y = new Foo(); y.baz();"), new String[] { STUB_DECLARATIONS + "function Foo() {}" + "Foo.prototype.baz = JSCompiler_stubMethod(0);", "Foo.prototype.baz = JSCompiler_unstubMethod(" + "    0, function(){var x = 1; x});" + "var y = new Foo(); y.baz();" }); [EOL] } <line_num>: 401,416
public void testInnerFunctionClosureVariableReads() { [EOL]     test(createModuleChain("function Foo() {}" + "Foo.prototype.baz = function(){var x = 1;" + "  return function(){x}};", "var y = new Foo(); y.baz();"), new String[] { STUB_DECLARATIONS + "function Foo() {}" + "Foo.prototype.baz = JSCompiler_stubMethod(0);", "Foo.prototype.baz = JSCompiler_unstubMethod(" + "    0, function(){var x = 1; return function(){x}});" + "var y = new Foo(); y.baz();" }); [EOL] } <line_num>: 419,435
public void testIssue600() { [EOL]     testSame(createModuleChain("var jQuery1 = (function() {\n" + "  var jQuery2 = function() {};\n" + "  var theLoneliestNumber = 1;\n" + "  jQuery2.prototype = {\n" + "    size: function() {\n" + "      return theLoneliestNumber;\n" + "    }\n" + "  };\n" + "  return jQuery2;\n" + "})();\n", "(function() {" + "  var div = jQuery1('div');" + "  div.size();" + "})();")); [EOL] } <line_num>: 437,455
public void testIssue600b() { [EOL]     testSame(createModuleChain("var jQuery1 = (function() {\n" + "  var jQuery2 = function() {};\n" + "  jQuery2.prototype = {\n" + "    size: function() {\n" + "      return 1;\n" + "    }\n" + "  };\n" + "  return jQuery2;\n" + "})();\n", "(function() {" + "  var div = jQuery1('div');" + "  div.size();" + "})();")); [EOL] } <line_num>: 457,474
public void testIssue600c() { [EOL]     test(createModuleChain("var jQuery2 = function() {};\n" + "jQuery2.prototype = {\n" + "  size: function() {\n" + "    return 1;\n" + "  }\n" + "};\n", "(function() {" + "  var div = jQuery2('div');" + "  div.size();" + "})();"), new String[] { STUB_DECLARATIONS + "var jQuery2 = function() {};\n" + "jQuery2.prototype = {\n" + "  size: JSCompiler_stubMethod(0)\n" + "};\n", "jQuery2.prototype.size=" + "    JSCompiler_unstubMethod(0,function(){return 1});" + "(function() {" + "  var div = jQuery2('div');" + "  div.size();" + "})();" }); [EOL] } <line_num>: 476,503
public void testIssue600d() { [EOL]     test(createModuleChain("var jQuery2 = function() {};\n" + "(function() {" + "  jQuery2.prototype = {\n" + "    size: function() {\n" + "      return 1;\n" + "    }\n" + "  };\n" + "})();", "(function() {" + "  var div = jQuery2('div');" + "  div.size();" + "})();"), new String[] { STUB_DECLARATIONS + "var jQuery2 = function() {};\n" + "(function() {" + "  jQuery2.prototype = {\n" + "    size: JSCompiler_stubMethod(0)\n" + "  };\n" + "})();", "jQuery2.prototype.size=" + "    JSCompiler_unstubMethod(0,function(){return 1});" + "(function() {" + "  var div = jQuery2('div');" + "  div.size();" + "})();" }); [EOL] } <line_num>: 505,536
public void testIssue600e() { [EOL]     testSame(createModuleChain("var jQuery2 = function() {};\n" + "(function() {" + "  var theLoneliestNumber = 1;\n" + "  jQuery2.prototype = {\n" + "    size: function() {\n" + "      return theLoneliestNumber;\n" + "    }\n" + "  };\n" + "})();", "(function() {" + "  var div = jQuery2('div');" + "  div.size();" + "})();")); [EOL] } <line_num>: 538,555
public void testPrototypeOfThisAssign() { [EOL]     testSame(createModuleChain("/** @constructor */" + "function F() {}" + "this.prototype.foo = function() {};", "(new F()).foo();")); [EOL] } <line_num>: 557,564
