public CollapsePropertiesTest() { [EOL]     super(EXTERNS); [EOL] } <line_num>: 35,37
@Override [EOL] public CompilerPass getProcessor(Compiler compiler) { [EOL]     return new CollapseProperties(compiler, collapsePropertiesOnExternTypes, true); [EOL] } <line_num>: 39,42
@Override [EOL] public void setUp() { [EOL]     enableLineNumberCheck(true); [EOL]     enableNormalize(true); [EOL] } <line_num>: 44,48
@Override [EOL] public int getNumRepetitions() { [EOL]     return 1; [EOL] } <line_num>: 50,52
public void testCollapse() { [EOL]     test("var a = {}; a.b = {}; var c = a.b;", "var a$b = {}; var c = a$b"); [EOL] } <line_num>: 54,57
public void testMultiLevelCollapse() { [EOL]     test("var a = {}; a.b = {}; a.b.c = {}; var d = a.b.c;", "var a$b$c = {}; var d = a$b$c;"); [EOL] } <line_num>: 59,62
public void testDecrement() { [EOL]     test("var a = {}; a.b = 5; a.b--; a.b = 5", "var a$b = 5; a$b--; a$b = 5"); [EOL] } <line_num>: 64,67
public void testIncrement() { [EOL]     test("var a = {}; a.b = 5; a.b++; a.b = 5", "var a$b = 5; a$b++; a$b = 5"); [EOL] } <line_num>: 69,72
public void testObjLitDeclaration() { [EOL]     test("var a = {b: {}, c: {}}; var d = a.b; var e = a.c", "var a$b = {}; var a$c = {}; var d = a$b; var e = a$c"); [EOL] } <line_num>: 74,77
public void testObjLitDeclarationWithGet1() { [EOL]     testSame("var a = {get b(){}};"); [EOL] } <line_num>: 79,81
public void testObjLitDeclarationWithGet2() { [EOL]     test("var a = {b: {}, get c(){}}; var d = a.b; var e = a.c", "var a$b = {};var a = {get c(){}};var d = a$b; var e = a.c"); [EOL] } <line_num>: 83,86
public void testObjLitDeclarationWithGet3() { [EOL]     test("var a = {b: {get c() { return 3; }}};", "var a$b = {get c() { return 3; }};"); [EOL] } <line_num>: 88,91
public void testObjLitDeclarationWithSet1() { [EOL]     testSame("var a = {set b(a){}};"); [EOL] } <line_num>: 93,95
public void testObjLitDeclarationWithSet2() { [EOL]     test("var a = {b: {}, set c(a){}}; var d = a.b; var e = a.c", "var a$b = {};var a = {set c(a){}};var d = a$b; var e = a.c"); [EOL] } <line_num>: 97,100
public void testObjLitDeclarationWithSet3() { [EOL]     test("var a = {b: {set c(d) {}}};", "var a$b = {set c(d) {}};"); [EOL] } <line_num>: 102,105
public void testObjLitDeclarationWithGetAndSet1() { [EOL]     test("var a = {b: {get c() { return 3; },set c(d) {}}};", "var a$b = {get c() { return 3; },set c(d) {}};"); [EOL] } <line_num>: 107,110
public void testObjLitDeclarationWithDuplicateKeys() { [EOL]     test("var a = {b: 0, b: 1}; var c = a.b;", "var a$b = 0; var a$b = 1; var c = a$b;", SyntacticScopeCreator.VAR_MULTIPLY_DECLARED_ERROR); [EOL] } <line_num>: 112,116
public void testObjLitAssignmentDepth1() { [EOL]     test("var a = {b: {}, c: {}}; var d = a.b; var e = a.c", "var a$b = {}; var a$c = {}; var d = a$b; var e = a$c"); [EOL] } <line_num>: 118,121
public void testObjLitAssignmentDepth2() { [EOL]     test("var a = {}; a.b = {c: {}, d: {}}; var e = a.b.c; var f = a.b.d", "var a$b$c = {}; var a$b$d = {}; var e = a$b$c; var f = a$b$d"); [EOL] } <line_num>: 123,126
public void testObjLitAssignmentDepth3() { [EOL]     test("var a = {}; a.b = {}; a.b.c = {d: 1, e: 2}; var f = a.b.c.d", "var a$b$c$d = 1; var a$b$c$e = 2; var f = a$b$c$d"); [EOL] } <line_num>: 128,131
public void testObjLitAssignmentDepth4() { [EOL]     test("var a = {}; a.b = {}; a.b.c = {}; a.b.c.d = {e: 1, f: 2}; " + "var g = a.b.c.d.e", "var a$b$c$d$e = 1; var a$b$c$d$f = 2; var g = a$b$c$d$e"); [EOL] } <line_num>: 133,137
public void testGlobalObjectDeclaredToPreserveItsPreviousValue1() { [EOL]     test("var a = a ? a : {}; a.c = 1;", "var a = a ? a : {}; var a$c = 1;"); [EOL] } <line_num>: 139,142
public void testGlobalObjectDeclaredToPreserveItsPreviousValue2() { [EOL]     test("var a = a || {}; a.c = 1;", "var a = a || {}; var a$c = 1;"); [EOL] } <line_num>: 144,147
public void testGlobalObjectDeclaredToPreserveItsPreviousValue3() { [EOL]     test("var a = a || {get b() {}}; a.c = 1;", "var a = a || {get b() {}}; var a$c = 1;"); [EOL] } <line_num>: 149,152
public void testGlobalObjectNameInBooleanExpressionDepth1_1() { [EOL]     test("var a = {b: 0}; a.c = 1; if (a) x();", "var a$b = 0; var a = {}; var a$c = 1; if (a) x();"); [EOL] } <line_num>: 154,157
public void testGlobalObjectNameInBooleanExpressionDepth1_2() { [EOL]     test("var a = {b: 0}; a.c = 1; if (!(a && a.c)) x();", "var a$b = 0; var a = {}; var a$c = 1; if (!(a && a$c)) x();"); [EOL] } <line_num>: 159,162
public void testGlobalObjectNameInBooleanExpressionDepth1_3() { [EOL]     test("var a = {b: 0}; a.c = 1; while (a || a.c) x();", "var a$b = 0; var a = {}; var a$c = 1; while (a || a$c) x();"); [EOL] } <line_num>: 164,167
public void testGlobalObjectNameInBooleanExpressionDepth1_4() { [EOL]     testSame("var a = {}; a.c = 1; var d = a || {}; a.c;"); [EOL] } <line_num>: 169,171
public void testGlobalObjectNameInBooleanExpressionDepth1_5() { [EOL]     testSame("var a = {}; a.c = 1; var d = a.c || a; a.c;"); [EOL] } <line_num>: 173,175
public void testGlobalObjectNameInBooleanExpressionDepth1_6() { [EOL]     test("var a = {b: 0}; a.c = 1; var d = !(a.c || a); a.c;", "var a$b = 0; var a = {}; var a$c = 1; var d = !(a$c || a); a$c;"); [EOL] } <line_num>: 177,180
public void testGlobalObjectNameInBooleanExpressionDepth2() { [EOL]     test("var a = {b: {}}; a.b.c = 1; if (a.b) x(a.b.c);", "var a$b = {}; var a$b$c = 1; if (a$b) x(a$b$c);"); [EOL] } <line_num>: 182,185
public void testGlobalObjectNameInBooleanExpressionDepth3() { [EOL]     test("var a = {}; a.b = {}; /** @constructor */ a.b.c = function(){};" + " a.b.z = 1; var d = a.b && a.b.c;", "var a$b = {}; var a$b$c = function(){};" + " a$b.z = 1; var d = a$b && a$b$c;", null, CollapseProperties.UNSAFE_NAMESPACE_WARNING); [EOL] } <line_num>: 187,198
public void testGlobalFunctionNameInBooleanExpressionDepth1() { [EOL]     test("function a() {} a.c = 1; if (a) x(a.c);", "function a() {} var a$c = 1; if (a) x(a$c);"); [EOL] } <line_num>: 200,203
public void testGlobalFunctionNameInBooleanExpressionDepth2() { [EOL]     test("var a = {b: function(){}}; a.b.c = 1; if (a.b) x(a.b.c);", "var a$b = function(){}; var a$b$c = 1; if (a$b) x(a$b$c);"); [EOL] } <line_num>: 205,208
public void testAliasCreatedForObjectDepth1_1() { [EOL]     testSame("var a = {b: 0}; var c = a; c.b = 1; a.b == c.b;"); [EOL] } <line_num>: 210,214
public void testAliasCreatedForObjectDepth1_2() { [EOL]     testSame("var a = {b: 0}; f(a); a.b;"); [EOL] } <line_num>: 216,218
public void testAliasCreatedForObjectDepth1_3() { [EOL]     testSame("var a = {b: 0}; new f(a); a.b;"); [EOL] } <line_num>: 220,222
public void testAliasCreatedForObjectDepth2_1() { [EOL]     test("var a = {}; a.b = {c: 0}; var d = a.b; a.b.c == d.c;", "var a$b = {c: 0}; var d = a$b; a$b.c == d.c;"); [EOL] } <line_num>: 224,227
public void testAliasCreatedForObjectDepth2_2() { [EOL]     test("var a = {}; a.b = {c: 0}; for (var p in a.b) { e(a.b[p]); }", "var a$b = {c: 0}; for (var p in a$b) { e(a$b[p]); }"); [EOL] } <line_num>: 229,232
public void testAliasCreatedForEnumDepth1_1() { [EOL]     test("/** @enum */ var a = {b: 0}; var c = a; c.b = 1; a.b != c.b;", "var a$b = 0; var a = {b: a$b}; var c = a; c.b = 1; a$b != c.b;"); [EOL] } <line_num>: 234,239
public void testAliasCreatedForEnumDepth1_2() { [EOL]     test("/** @enum */ var a = {b: 0}; f(a); a.b;", "var a$b = 0; var a = {b: a$b}; f(a); a$b;"); [EOL] } <line_num>: 241,244
public void testAliasCreatedForEnumDepth1_3() { [EOL]     test("/** @enum */ var a = {b: 0}; new f(a); a.b;", "var a$b = 0; var a = {b: a$b}; new f(a); a$b;"); [EOL] } <line_num>: 246,249
public void testAliasCreatedForEnumDepth1_4() { [EOL]     test("/** @enum */ var a = {b: 0}; for (var p in a) { f(a[p]); }", "var a$b = 0; var a = {b: a$b}; for (var p in a) { f(a[p]); }"); [EOL] } <line_num>: 251,254
public void testAliasCreatedForEnumDepth2_1() { [EOL]     test("var a = {}; /** @enum */ a.b = {c: 0};" + "var d = a.b; d.c = 1; a.b.c != d.c;", "var a$b$c = 0; var a$b = {c: a$b$c};" + "var d = a$b; d.c = 1; a$b$c != d.c;"); [EOL] } <line_num>: 256,261
public void testAliasCreatedForEnumDepth2_2() { [EOL]     test("var a = {}; /** @enum */ a.b = {c: 0};" + "for (var p in a.b) { f(a.b[p]); }", "var a$b$c = 0; var a$b = {c: a$b$c};" + "for (var p in a$b) { f(a$b[p]); }"); [EOL] } <line_num>: 263,268
public void testAliasCreatedForEnumDepth2_3() { [EOL]     test("var a = {}; var d = a; /** @enum */ a.b = {c: 0};" + "for (var p in a.b) { f(a.b[p]); }", "var a = {}; var d = a; var a$b$c = 0; var a$b = {c: a$b$c};" + "for (var p in a$b) { f(a$b[p]); }", null, CollapseProperties.UNSAFE_NAMESPACE_WARNING); [EOL] } <line_num>: 270,276
public void testAliasCreatedForEnumOfObjects() { [EOL]     test("var a = {}; " + "/** @enum {Object} */ a.b = {c: {d: 1}}; a.b.c;" + "searchEnum(a.b);", "var a$b$c = {d: 1};var a$b = {c: a$b$c}; a$b$c; " + "searchEnum(a$b)"); [EOL] } <line_num>: 278,284
public void testAliasCreatedForEnumOfObjects2() { [EOL]     test("var a = {}; " + "/** @enum {Object} */ a.b = {c: {d: 1}}; a.b.c.d;" + "searchEnum(a.b);", "var a$b$c = {d: 1};var a$b = {c: a$b$c}; a$b$c.d; " + "searchEnum(a$b)"); [EOL] } <line_num>: 286,292
public void testAliasCreatedForPropertyOfEnumOfObjects() { [EOL]     test("var a = {}; " + "/** @enum {Object} */ a.b = {c: {d: 1}}; a.b.c;" + "searchEnum(a.b.c);", "var a$b$c = {d: 1}; a$b$c; searchEnum(a$b$c);"); [EOL] } <line_num>: 294,299
public void testAliasCreatedForPropertyOfEnumOfObjects2() { [EOL]     test("var a = {}; " + "/** @enum {Object} */ a.b = {c: {d: 1}}; a.b.c.d;" + "searchEnum(a.b.c);", "var a$b$c = {d: 1}; a$b$c.d; searchEnum(a$b$c);"); [EOL] } <line_num>: 301,306
public void testMisusedEnumTag() { [EOL]     testSame("var a = {}; var d = a; a.b = function() {};" + "/** @enum */ a.b.c = 0; a.b.c;"); [EOL] } <line_num>: 308,311
public void testMisusedConstructorTag() { [EOL]     testSame("var a = {}; var d = a; a.b = function() {};" + "/** @constructor */ a.b.c = 0; a.b.c;"); [EOL] } <line_num>: 313,316
public void testAliasCreatedForFunctionDepth1_1() { [EOL]     testSame("var a = function(){}; a.b = 1; var c = a; c.b = 2; a.b != c.b;"); [EOL] } <line_num>: 318,320
public void testAliasCreatedForCtorDepth1_1() { [EOL]     test("/** @constructor */ var a = function(){}; a.b = 1; " + "var c = a; c.b = 2; a.b != c.b;", "var a = function(){}; var a$b = 1; var c = a; c.b = 2; a$b != c.b;"); [EOL] } <line_num>: 322,332
public void testAliasCreatedForFunctionDepth1_2() { [EOL]     testSame("var a = function(){}; a.b = 1; f(a); a.b;"); [EOL] } <line_num>: 334,336
public void testAliasCreatedForCtorDepth1_2() { [EOL]     test("/** @constructor */ var a = function(){}; a.b = 1; f(a); a.b;", "var a = function(){}; var a$b = 1; f(a); a$b;"); [EOL] } <line_num>: 338,341
public void testAliasCreatedForFunctionDepth1_3() { [EOL]     testSame("var a = function(){}; a.b = 1; new f(a); a.b;"); [EOL] } <line_num>: 343,345
public void testAliasCreatedForCtorDepth1_3() { [EOL]     test("/** @constructor */ var a = function(){}; a.b = 1; new f(a); a.b;", "var a = function(){}; var a$b = 1; new f(a); a$b;"); [EOL] } <line_num>: 347,350
public void testAliasCreatedForFunctionDepth2() { [EOL]     test("var a = {}; a.b = function() {}; a.b.c = 1; var d = a.b;" + "a.b.c != d.c;", "var a$b = function() {}; a$b.c = 1; var d = a$b;" + "a$b.c != d.c;"); [EOL] } <line_num>: 352,358
public void testAliasCreatedForCtorDepth2() { [EOL]     test("var a = {}; /** @constructor */ a.b = function() {}; " + "a.b.c = 1; var d = a.b;" + "a.b.c != d.c;", "var a$b = function() {}; var a$b$c = 1; var d = a$b;" + "a$b$c != d.c;"); [EOL] } <line_num>: 360,366
public void testAliasCreatedForClassDepth1_1() { [EOL]     test("var a = {}; /** @constructor */ a.b = function(){};" + "var c = a; c.b = 0; a.b != c.b;", "var a = {}; var a$b = function(){};" + "var c = a; c.b = 0; a$b != c.b;", null, CollapseProperties.UNSAFE_NAMESPACE_WARNING); [EOL] } <line_num>: 368,376
public void testAliasCreatedForClassDepth1_2() { [EOL]     test("var a = {}; /** @constructor */ a.b = function(){}; f(a); a.b;", "var a = {}; var a$b = function(){}; f(a); a$b;", null, CollapseProperties.UNSAFE_NAMESPACE_WARNING); [EOL] } <line_num>: 378,382
public void testAliasCreatedForClassDepth1_3() { [EOL]     test("var a = {}; /** @constructor */ a.b = function(){}; new f(a); a.b;", "var a = {}; var a$b = function(){}; new f(a); a$b;", null, CollapseProperties.UNSAFE_NAMESPACE_WARNING); [EOL] } <line_num>: 384,388
public void testAliasCreatedForClassDepth2_1() { [EOL]     test("var a = {}; a.b = {}; /** @constructor */ a.b.c = function(){};" + "var d = a.b; a.b.c != d.c;", "var a$b = {}; var a$b$c = function(){};" + "var d = a$b; a$b$c != d.c;", null, CollapseProperties.UNSAFE_NAMESPACE_WARNING); [EOL] } <line_num>: 390,396
public void testAliasCreatedForClassDepth2_2() { [EOL]     test("var a = {}; a.b = {}; /** @constructor */ a.b.c = function(){};" + "f(a.b); a.b.c;", "var a$b = {}; var a$b$c = function(){}; f(a$b); a$b$c;", null, CollapseProperties.UNSAFE_NAMESPACE_WARNING); [EOL] } <line_num>: 398,403
public void testAliasCreatedForClassDepth2_3() { [EOL]     test("var a = {}; a.b = {}; /** @constructor */ a.b.c = function(){};" + "new f(a.b); a.b.c;", "var a$b = {}; var a$b$c = function(){}; new f(a$b); a$b$c;", null, CollapseProperties.UNSAFE_NAMESPACE_WARNING); [EOL] } <line_num>: 405,410
public void testAliasCreatedForClassProperty() { [EOL]     test("var a = {}; /** @constructor */ a.b = function(){};" + "a.b.c = {d: 3}; new f(a.b.c); a.b.c.d;", "var a$b = function(){}; var a$b$c = {d:3}; new f(a$b$c); a$b$c.d;"); [EOL] } <line_num>: 412,416
public void testNestedObjLit() { [EOL]     test("var a = {}; a.b = {f: 0, c: {d: 1}}; var e = a.b.c.d", "var a$b$f = 0; var a$b$c$d = 1; var e = a$b$c$d;"); [EOL] } <line_num>: 418,421
public void testObjLitDeclarationUsedInSameVarList() { [EOL]     test("var a = {b: {}, c: {}}; var d = a.b; var e = a.c;", "var a$b = {}; var a$c = {}; var d = a$b; var e = a$c;"); [EOL] } <line_num>: 423,428
public void testPropGetInsideAnObjLit() { [EOL]     test("var x = {}; x.y = 1; var a = {}; a.b = {c: x.y}", "var x$y = 1; var a$b$c = x$y;"); [EOL] } <line_num>: 430,433
public void testObjLitWithQuotedKeyThatDoesNotGetRead() { [EOL]     test("var a = {}; a.b = {c: 0, 'd': 1}; var e = a.b.c;", "var a$b$c = 0; var a$b$d = 1; var e = a$b$c;"); [EOL] } <line_num>: 435,438
public void testObjLitWithQuotedKeyThatGetsRead() { [EOL]     test("var a = {}; a.b = {c: 0, 'd': 1}; var e = a.b['d'];", "var a$b = {c: 0, 'd': 1}; var e = a$b['d'];"); [EOL] } <line_num>: 440,443
public void testFunctionWithQuotedPropertyThatDoesNotGetRead() { [EOL]     test("var a = {}; a.b = function() {}; a.b['d'] = 1;", "var a$b = function() {}; a$b['d'] = 1;"); [EOL] } <line_num>: 445,448
public void testFunctionWithQuotedPropertyThatGetsRead() { [EOL]     test("var a = {}; a.b = function() {}; a.b['d'] = 1; f(a.b['d']);", "var a$b = function() {}; a$b['d'] = 1; f(a$b['d']);"); [EOL] } <line_num>: 450,453
public void testObjLitAssignedToMultipleNames1() { [EOL]     testSame("var a = b = {c: 0, d: 1}; var e = a.c; var f = b.d;"); [EOL] } <line_num>: 455,458
public void testObjLitAssignedToMultipleNames2() { [EOL]     testSame("a = b = {c: 0, d: 1}; var e = a.c; var f = b.d;"); [EOL] } <line_num>: 460,462
public void testObjLitRedefinedInGlobalScope() { [EOL]     testSame("a = {b: 0}; a = {c: 1}; var d = a.b; var e = a.c;"); [EOL] } <line_num>: 464,466
public void testObjLitRedefinedInLocalScope() { [EOL]     test("var a = {}; a.b = {c: 0}; function d() { a.b = {c: 1}; } e(a.b.c);", "var a$b = {c: 0}; function d() { a$b = {c: 1}; } e(a$b.c);"); [EOL] } <line_num>: 468,471
public void testObjLitAssignedInTernaryExpression1() { [EOL]     testSame("a = x ? {b: 0} : d; var c = a.b;"); [EOL] } <line_num>: 473,475
public void testObjLitAssignedInTernaryExpression2() { [EOL]     testSame("a = x ? {b: 0} : {b: 1}; var c = a.b;"); [EOL] } <line_num>: 477,479
public void testGlobalVarSetToObjLitConditionally1() { [EOL]     testSame("var a; if (x) a = {b: 0}; var c = x ? a.b : 0;"); [EOL] } <line_num>: 481,483
public void testGlobalVarSetToObjLitConditionally1b() { [EOL]     test("if (x) var a = {b: 0}; var c = x ? a.b : 0;", "if (x) var a$b = 0; var c = x ? a$b : 0;"); [EOL] } <line_num>: 485,488
public void testGlobalVarSetToObjLitConditionally2() { [EOL]     test("if (x) var a = {b: 0}; var c = a.b; var d = a.c;", "if (x){ var a$b = 0; var a = {}; }var c = a$b; var d = a.c;"); [EOL] } <line_num>: 490,493
public void testGlobalVarSetToObjLitConditionally3() { [EOL]     testSame("var a; if (x) a = {b: 0}; else a = {b: 1}; var c = a.b;"); [EOL] } <line_num>: 495,497
public void testObjectPropertySetToObjLitConditionally() { [EOL]     test("var a = {}; if (x) a.b = {c: 0}; var d = a.b ? a.b.c : 0;", "if (x){ var a$b$c = 0; var a$b = {} } var d = a$b ? a$b$c : 0;"); [EOL] } <line_num>: 499,502
public void testFunctionPropertySetToObjLitConditionally() { [EOL]     test("function a() {} if (x) a.b = {c: 0}; var d = a.b ? a.b.c : 0;", "function a() {} if (x){ var a$b$c = 0; var a$b = {} }" + "var d = a$b ? a$b$c : 0;"); [EOL] } <line_num>: 504,508
public void testPrototypePropertySetToAnObjectLiteral() { [EOL]     test("var a = {b: function(){}}; a.b.prototype.c = {d: 0};", "var a$b = function(){}; a$b.prototype.c = {d: 0};"); [EOL] } <line_num>: 510,513
public void testObjectPropertyResetInLocalScope() { [EOL]     test("var z = {}; z.a = 0; function f() {z.a = 5; return z.a}", "var z$a = 0; function f() {z$a = 5; return z$a}"); [EOL] } <line_num>: 515,518
public void testFunctionPropertyResetInLocalScope() { [EOL]     test("function z() {} z.a = 0; function f() {z.a = 5; return z.a}", "function z() {} var z$a = 0; function f() {z$a = 5; return z$a}"); [EOL] } <line_num>: 520,523
public void testNamespaceResetInGlobalScope1() { [EOL]     test("var a = {}; /** @constructor */a.b = function() {}; a = {};", "var a = {}; var a$b = function() {}; a = {};", null, CollapseProperties.NAMESPACE_REDEFINED_WARNING); [EOL] } <line_num>: 525,529
public void testNamespaceResetInGlobalScope2() { [EOL]     test("var a = {}; a = {}; /** @constructor */a.b = function() {};", "var a = {}; a = {}; var a$b = function() {};", null, CollapseProperties.NAMESPACE_REDEFINED_WARNING); [EOL] } <line_num>: 531,535
public void testNamespaceResetInLocalScope1() { [EOL]     test("var a = {}; /** @constructor */a.b = function() {};" + " function f() { a = {}; }", "var a = {};var a$b = function() {};" + " function f() { a = {}; }", null, CollapseProperties.NAMESPACE_REDEFINED_WARNING); [EOL] } <line_num>: 537,543
public void testNamespaceResetInLocalScope2() { [EOL]     test("var a = {}; function f() { a = {}; }" + " /** @constructor */a.b = function() {};", "var a = {}; function f() { a = {}; }" + " var a$b = function() {};", null, CollapseProperties.NAMESPACE_REDEFINED_WARNING); [EOL] } <line_num>: 545,551
public void testNamespaceDefinedInLocalScope() { [EOL]     test("var a = {}; (function() { a.b = {}; })();" + " /** @constructor */a.b.c = function() {};", "var a$b; (function() { a$b = {}; })(); var a$b$c = function() {};"); [EOL] } <line_num>: 553,557
public void testAddPropertyToObjectInLocalScopeDepth1() { [EOL]     test("var a = {b: 0}; function f() { a.c = 5; return a.c; }", "var a$b = 0; var a$c; function f() { a$c = 5; return a$c; }"); [EOL] } <line_num>: 559,562
public void testAddPropertyToObjectInLocalScopeDepth2() { [EOL]     test("var a = {}; a.b = {}; (function() {a.b.c = 0;})(); x = a.b.c;", "var a$b$c; (function() {a$b$c = 0;})(); x = a$b$c;"); [EOL] } <line_num>: 564,567
public void testAddPropertyToFunctionInLocalScopeDepth1() { [EOL]     test("function a() {} function f() { a.c = 5; return a.c; }", "function a() {} var a$c; function f() { a$c = 5; return a$c; }"); [EOL] } <line_num>: 569,572
public void testAddPropertyToFunctionInLocalScopeDepth2() { [EOL]     test("var a = {}; a.b = function() {}; function f() {a.b.c = 0;}", "var a$b = function() {}; var a$b$c; function f() {a$b$c = 0;}"); [EOL] } <line_num>: 574,577
public void testAddPropertyToUncollapsibleObjectInLocalScopeDepth1() { [EOL]     testSame("var a = {}; var c = a; (function() {a.b = 0;})(); a.b;"); [EOL] } <line_num>: 579,581
public void testAddPropertyToUncollapsibleFunctionInLocalScopeDepth1() { [EOL]     testSame("function a() {} var c = a; (function() {a.b = 0;})(); a.b;"); [EOL] } <line_num>: 583,585
public void testAddPropertyToUncollapsibleNamedCtorInLocalScopeDepth1() { [EOL]     testSame("/** @constructor */ function a() {} var a$b; var c = a; " + "(function() {a$b = 0;})(); a$b;"); [EOL] } <line_num>: 587,591
public void testAddPropertyToUncollapsibleCtorInLocalScopeDepth1() { [EOL]     test("/** @constructor */ var a = function() {}; var c = a; " + "(function() {a.b = 0;})(); a.b;", "var a = function() {}; var a$b; " + "var c = a; (function() {a$b = 0;})(); a$b;"); [EOL] } <line_num>: 593,598
public void testAddPropertyToUncollapsibleObjectInLocalScopeDepth2() { [EOL]     test("var a = {}; a.b = {}; var d = a.b;" + "(function() {a.b.c = 0;})(); a.b.c;", "var a$b = {}; var d = a$b;" + "(function() {a$b.c = 0;})(); a$b.c;"); [EOL] } <line_num>: 600,605
public void testAddPropertyToUncollapsibleFunctionInLocalScopeDepth2() { [EOL]     test("var a = {}; a.b = function (){}; var d = a.b;" + "(function() {a.b.c = 0;})(); a.b.c;", "var a$b = function (){}; var d = a$b;" + "(function() {a$b.c = 0;})(); a$b.c;"); [EOL] } <line_num>: 607,612
public void testAddPropertyToUncollapsibleCtorInLocalScopeDepth2() { [EOL]     test("var a = {}; /** @constructor */ a.b = function (){}; var d = a.b;" + "(function() {a.b.c = 0;})(); a.b.c;", "var a$b = function (){}; var a$b$c; var d = a$b;" + "(function() {a$b$c = 0;})(); a$b$c;"); [EOL] } <line_num>: 614,619
public void testPropertyOfChildFuncOfUncollapsibleObjectDepth1() { [EOL]     testSame("var a = {}; var c = a; a.b = function (){}; a.b.x = 0; a.b.x;"); [EOL] } <line_num>: 621,623
public void testPropertyOfChildFuncOfUncollapsibleObjectDepth2() { [EOL]     test("var a = {}; a.b = {}; var c = a.b;" + "a.b.c = function (){}; a.b.c.x = 0; a.b.c.x;", "var a$b = {}; var c = a$b;" + "a$b.c = function (){}; a$b.c.x = 0; a$b.c.x;"); [EOL] } <line_num>: 625,630
public void testAddPropertyToChildFuncOfUncollapsibleObjectInLocalScope() { [EOL]     testSame("var a = {}; a.b = function (){}; a.b.x = 0;" + "var c = a; (function() {a.b.y = 1;})(); a.b.x; a.b.y;"); [EOL] } <line_num>: 632,635
public void testAddPropertyToChildTypeOfUncollapsibleObjectInLocalScope() { [EOL]     test("var a = {}; /** @constructor */ a.b = function (){}; a.b.x = 0;" + "var c = a; (function() {a.b.y = 1;})(); a.b.x; a.b.y;", "var a = {}; var a$b = function (){}; var a$b$y; var a$b$x = 0;" + "var c = a; (function() {a$b$y = 1;})(); a$b$x; a$b$y;", null, CollapseProperties.UNSAFE_NAMESPACE_WARNING); [EOL] } <line_num>: 637,643
public void testAddPropertyToChildOfUncollapsibleFunctionInLocalScope() { [EOL]     testSame("function a() {} a.b = {x: 0}; var c = a;" + "(function() {a.b.y = 0;})(); a.b.y;"); [EOL] } <line_num>: 645,649
public void testAddPropertyToChildOfUncollapsibleCtorInLocalScope() { [EOL]     test("/** @constructor */ var a = function() {}; a.b = {x: 0}; var c = a;" + "(function() {a.b.y = 0;})(); a.b.y;", "var a = function() {}; var a$b$x = 0; var a$b$y; var c = a;" + "(function() {a$b$y = 0;})(); a$b$y;"); [EOL] } <line_num>: 651,656
public void testResetObjectPropertyInLocalScope() { [EOL]     test("var a = {b: 0}; a.c = 1; function f() { a.c = 5; }", "var a$b = 0; var a$c = 1; function f() { a$c = 5; }"); [EOL] } <line_num>: 658,661
public void testResetFunctionPropertyInLocalScope() { [EOL]     test("function a() {}; a.c = 1; function f() { a.c = 5; }", "function a() {}; var a$c = 1; function f() { a$c = 5; }"); [EOL] } <line_num>: 663,666
public void testGlobalNameReferencedInLocalScopeBeforeDefined1() { [EOL]     test("var a = {b: 0}; function f() { a.c = 5; } a.c = 1;", "var a$b = 0; function f() { a$c = 5; } var a$c = 1;"); [EOL] } <line_num>: 668,675
public void testGlobalNameReferencedInLocalScopeBeforeDefined2() { [EOL]     test("var a = {b: 0}; function f() { return a.c; } a.c = 1;", "var a$b = 0; function f() { return a$c; } var a$c = 1;"); [EOL] } <line_num>: 677,680
public void testTwiceDefinedGlobalNameDepth1_1() { [EOL]     testSame("var a = {}; function f() { a.b(); }" + "a = function() {}; a.b = function() {};"); [EOL] } <line_num>: 682,685
public void testTwiceDefinedGlobalNameDepth1_2() { [EOL]     testSame("var a = {}; /** @constructor */ a = function() {};" + "a.b = {}; a.b.c = 0; function f() { a.b.d = 1; }"); [EOL] } <line_num>: 687,690
public void testTwiceDefinedGlobalNameDepth2() { [EOL]     test("var a = {}; a.b = {}; function f() { a.b.c(); }" + "a.b = function() {}; a.b.c = function() {};", "var a$b = {}; function f() { a$b.c(); }" + "a$b = function() {}; a$b.c = function() {};"); [EOL] } <line_num>: 692,697
public void testFunctionCallDepth1() { [EOL]     test("var a = {}; a.b = function(){}; var c = a.b();", "var a$b = function(){}; var c = a$b()"); [EOL] } <line_num>: 699,702
public void testFunctionCallDepth2() { [EOL]     test("var a = {}; a.b = {}; a.b.c = function(){}; a.b.c();", "var a$b$c = function(){}; a$b$c();"); [EOL] } <line_num>: 704,707
public void testFunctionAlias() { [EOL]     test("var a = {}; a.b = {}; a.b.c = function(){}; a.b.d = a.b.c;", "var a$b$c = function(){}; var a$b$d = a$b$c;"); [EOL] } <line_num>: 709,712
public void testCallToRedefinedFunction() { [EOL]     test("var a = {}; a.b = function(){}; a.b = function(){}; a.b();", "var a$b = function(){}; a$b = function(){}; a$b();"); [EOL] } <line_num>: 714,717
public void testCollapsePrototypeName() { [EOL]     test("var a = {}; a.b = {}; a.b.c = function(){}; " + "a.b.c.prototype.d = function(){}; (new a.b.c()).d();", "var a$b$c = function(){}; a$b$c.prototype.d = function(){}; " + "new a$b$c().d();"); [EOL] } <line_num>: 719,724
public void testReferencedPrototypeProperty() { [EOL]     test("var a = {b: {}}; a.b.c = function(){}; a.b.c.prototype.d = {};" + "e = a.b.c.prototype.d;", "var a$b$c = function(){}; a$b$c.prototype.d = {};" + "e = a$b$c.prototype.d;"); [EOL] } <line_num>: 726,731
public void testSetStaticAndPrototypePropertiesOnFunction() { [EOL]     test("var a = {}; a.b = function(){}; a.b.prototype.d = 0; a.b.c = 1;", "var a$b = function(){}; a$b.prototype.d = 0; var a$b$c = 1;"); [EOL] } <line_num>: 733,736
public void testReadUndefinedPropertyDepth1() { [EOL]     test("var a = {b: 0}; var c = a.d;", "var a$b = 0; var a = {}; var c = a.d;"); [EOL] } <line_num>: 738,741
public void testReadUndefinedPropertyDepth2() { [EOL]     test("var a = {b: {c: 0}}; f(a.b.c); f(a.b.d);", "var a$b$c = 0; var a$b = {}; f(a$b$c); f(a$b.d);"); [EOL] } <line_num>: 743,746
public void testCallUndefinedMethodOnObjLitDepth1() { [EOL]     test("var a = {b: 0}; a.c();", "var a$b = 0; var a = {}; a.c();"); [EOL] } <line_num>: 748,751
public void testCallUndefinedMethodOnObjLitDepth2() { [EOL]     test("var a = {b: {}}; a.b.c = function() {}; a.b.c(); a.b.d();", "var a$b = {}; var a$b$c = function() {}; a$b$c(); a$b.d();"); [EOL] } <line_num>: 753,756
public void testPropertiesOfAnUndefinedVar() { [EOL]     testSame("a.document = d; f(a.document.innerHTML);"); [EOL] } <line_num>: 758,760
public void testPropertyOfAnObjectThatIsNeitherFunctionNorObjLit() { [EOL]     testSame("var a = window; a.document = d; f(a.document)"); [EOL] } <line_num>: 762,764
public void testStaticFunctionReferencingThis1() { [EOL]     test("var a = {}; a.b = function() {this.c}; var d = a.b;", "var a$b = function() {this.c}; var d = a$b;", null, UNSAFE_THIS); [EOL] } <line_num>: 766,771
public void testStaticFunctionReferencingThis2() { [EOL]     test("var a = {}; " + "a.b = function() { return function(){ return this; }; };", "var a$b = function() { return function(){ return this; }; };"); [EOL] } <line_num>: 773,779
public void testStaticFunctionReferencingThis3() { [EOL]     test("var a = {b: function() {this.c}};", "var a$b = function() { this.c };", null, UNSAFE_THIS); [EOL] } <line_num>: 781,784
public void testStaticFunctionReferencingThis4() { [EOL]     test("var a = {/** @this {Element} */ b: function() {this.c}};", "var a$b = function() { this.c };"); [EOL] } <line_num>: 786,789
public void testPrototypeMethodReferencingThis() { [EOL]     testSame("var A = function(){}; A.prototype = {b: function() {this.c}};"); [EOL] } <line_num>: 791,793
public void testConstructorReferencingThis() { [EOL]     test("var a = {}; " + "/** @constructor */ a.b = function() { this.a = 3; };", "var a$b = function() { this.a = 3; };"); [EOL] } <line_num>: 795,799
public void testSafeReferenceOfThis() { [EOL]     test("var a = {}; " + "/** @this {Object} */ a.b = function() { this.a = 3; };", "var a$b = function() { this.a = 3; };"); [EOL] } <line_num>: 801,805
public void testGlobalFunctionReferenceOfThis() { [EOL]     testSame("var a = function() { this.a = 3; };"); [EOL] } <line_num>: 807,809
public void testFunctionGivenTwoNames() { [EOL]     test("var f = function g() {}; f.a = 1; h(f.a);", "var f = function g() {}; var f$a = 1; h(f$a);"); [EOL] } <line_num>: 811,816
public void testObjLitWithUsedNumericKey() { [EOL]     testSame("a = {40: {}, c: {}}; var d = a[40]; var e = a.c;"); [EOL] } <line_num>: 818,820
public void testObjLitWithUnusedNumericKey() { [EOL]     test("var a = {40: {}, c: {}}; var e = a.c;", "var a$1 = {}; var a$c = {}; var e = a$c"); [EOL] } <line_num>: 822,825
public void testObjLitWithNonIdentifierKeys() { [EOL]     testSame("a = {' ': 0, ',': 1}; var c = a[' '];"); [EOL] } <line_num>: 827,829
public void testChainedAssignments1() { [EOL]     test("var x = {}; x.y = a = 0;", "var x$y = a = 0;"); [EOL] } <line_num>: 831,834
public void testChainedAssignments2() { [EOL]     test("var x = {}; x.y = a = b = c();", "var x$y = a = b = c();"); [EOL] } <line_num>: 836,839
public void testChainedAssignments3() { [EOL]     test("var x = {y: 1}; a = b = x.y;", "var x$y = 1; a = b = x$y;"); [EOL] } <line_num>: 841,844
public void testChainedAssignments4() { [EOL]     test("var x = {}; a = b = x.y;", "var x = {}; a = b = x.y;"); [EOL] } <line_num>: 846,849
public void testChainedAssignments5() { [EOL]     test("var x = {}; a = x.y = 0;", "var x$y; a = x$y = 0;"); [EOL] } <line_num>: 851,853
public void testChainedAssignments6() { [EOL]     test("var x = {}; a = x.y = b = c();", "var x$y; a = x$y = b = c();"); [EOL] } <line_num>: 855,858
public void testChainedAssignments7() { [EOL]     test("var x = {}; a = x.y = {}; /** @constructor */ x.y.z = function() {};", "var x$y; a = x$y = {}; var x$y$z = function() {};", null, CollapseProperties.UNSAFE_NAMESPACE_WARNING); [EOL] } <line_num>: 860,864
public void testChainedVarAssignments1() { [EOL]     test("var x = {y: 1}; var a = x.y = 0;", "var x$y = 1; var a = x$y = 0;"); [EOL] } <line_num>: 866,869
public void testChainedVarAssignments2() { [EOL]     test("var x = {y: 1}; var a = x.y = b = 0;", "var x$y = 1; var a = x$y = b = 0;"); [EOL] } <line_num>: 871,874
public void testChainedVarAssignments3() { [EOL]     test("var x = {y: {z: 1}}; var b = 0; var a = x.y.z = 1; var c = 2;", "var x$y$z = 1; var b = 0; var a = x$y$z = 1; var c = 2;"); [EOL] } <line_num>: 876,879
public void testChainedVarAssignments4() { [EOL]     test("var x = {}; var a = b = x.y = 0;", "var x$y; var a = b = x$y = 0;"); [EOL] } <line_num>: 881,884
public void testChainedVarAssignments5() { [EOL]     test("var x = {y: {}}; var a = b = x.y.z = 0;", "var x$y$z; var a = b = x$y$z = 0;"); [EOL] } <line_num>: 886,889
public void testPeerAndSubpropertyOfUncollapsibleProperty() { [EOL]     test("var x = {}; var a = x.y = 0; x.w = 1; x.y.z = 2;" + "b = x.w; c = x.y.z;", "var x$y; var a = x$y = 0; var x$w = 1; x$y.z = 2;" + "b = x$w; c = x$y.z;"); [EOL] } <line_num>: 891,896
public void testComplexAssignmentAfterInitialAssignment() { [EOL]     test("var d = {}; d.e = {}; d.e.f = 0; a = b = d.e.f = 1;", "var d$e$f = 0; a = b = d$e$f = 1;"); [EOL] } <line_num>: 898,901
public void testRenamePrefixOfUncollapsibleProperty() { [EOL]     test("var d = {}; d.e = {}; a = b = d.e.f = 0;", "var d$e$f; a = b = d$e$f = 0;"); [EOL] } <line_num>: 903,906
public void testNewOperator() { [EOL]     test("var a = {}; a.b = function() {}; a.b.c = 1; var d = new a.b();", "var a$b = function() {}; var a$b$c = 1; var d = new a$b();"); [EOL] } <line_num>: 908,913
public void testMethodCall() { [EOL]     test("var a = {}; a.b = function() {}; var d = a.b();", "var a$b = function() {}; var d = a$b();"); [EOL] } <line_num>: 915,918
public void testObjLitDefinedInLocalScopeIsLeftAlone() { [EOL]     test("var a = {}; a.b = function() {};" + "a.b.prototype.f_ = function() {" + "  var x = { p: '', q: '', r: ''}; var y = x.q;" + "};", "var a$b = function() {};" + "a$b.prototype.f_ = function() {" + "  var x = { p: '', q: '', r: ''}; var y = x.q;" + "};"); [EOL] } <line_num>: 920,929
public void testPropertiesOnBothSidesOfAssignment() { [EOL]     test("var a = {b: 0}; a.c = a.b;", "var a$b = 0; var a$c = a$b;"); [EOL] } <line_num>: 931,936
public void testCallOnUndefinedProperty() { [EOL]     test("var a = {}; a.b = function(){}; a.b.inherits(x);", "var a$b = function(){}; a$b.inherits(x);"); [EOL] } <line_num>: 938,945
public void testGetPropOnUndefinedProperty() { [EOL]     test("var a = {b: function(){}}; a.b.prototype.c =" + "function() { a.b.superClass_.c.call(this); }", "var a$b = function(){}; a$b.prototype.c =" + "function() { a$b.superClass_.c.call(this); }"); [EOL] } <line_num>: 947,956
public void testLocalAlias1() { [EOL]     test("var a = {b: 3}; function f() { var x = a; f(x.b); }", "var a$b = 3; function f() { var x = null; f(a$b); }"); [EOL] } <line_num>: 958,961
public void testLocalAlias2() { [EOL]     test("var a = {b: 3, c: 4}; function f() { var x = a; f(x.b); f(x.c);}", "var a$b = 3; var a$c = 4; " + "function f() { var x = null; f(a$b); f(a$c);}"); [EOL] } <line_num>: 963,967
public void testLocalAlias3() { [EOL]     test("var a = {b: 3, c: {d: 5}}; " + "function f() { var x = a; f(x.b); f(x.c); f(x.c.d); }", "var a$b = 3; var a$c = {d: 5}; " + "function f() { var x = null; f(a$b); f(a$c); f(a$c.d);}"); [EOL] } <line_num>: 969,974
public void testLocalAlias4() { [EOL]     test("var a = {b: 3}; var c = {d: 5}; " + "function f() { var x = a; var y = c; f(x.b); f(y.d); }", "var a$b = 3; var c$d = 5; " + "function f() { var x = null; var y = null; f(a$b); f(c$d);}"); [EOL] } <line_num>: 976,981
public void testLocalAlias5() { [EOL]     test("var a = {b: {c: 5}}; " + "function f() { var x = a; var y = x.b; f(a.b.c); f(y.c); }", "var a$b$c = 5; " + "function f() { var x = null; var y = null; f(a$b$c); f(a$b$c);}"); [EOL] } <line_num>: 983,988
public void testLocalAlias6() { [EOL]     test("var a = {b: 3}; function f() { var x = a; if (x.b) { f(x.b); } }", "var a$b = 3; function f() { var x = null; if (a$b) { f(a$b); } }"); [EOL] } <line_num>: 990,993
public void testLocalAlias7() { [EOL]     test("var a = {b: {c: 5}}; function f() { var x = a.b; f(x.c); }", "var a$b$c = 5; function f() { var x = null; f(a$b$c); }"); [EOL] } <line_num>: 995,998
public void testGlobalWriteToAncestor() { [EOL]     testSame("var a = {b: 3}; function f() { var x = a; f(a.b); } a = 5;"); [EOL] } <line_num>: 1000,1002
public void testGlobalWriteToNonAncestor() { [EOL]     test("var a = {b: 3}; function f() { var x = a; f(a.b); } a.b = 5;", "var a$b = 3; function f() { var x = null; f(a$b); } a$b = 5;"); [EOL] } <line_num>: 1004,1007
public void testLocalWriteToAncestor() { [EOL]     testSame("var a = {b: 3}; function f() { a = 5; var x = a; f(a.b); } "); [EOL] } <line_num>: 1009,1011
public void testLocalWriteToNonAncestor() { [EOL]     test("var a = {b: 3}; " + "function f() { a.b = 5; var x = a; f(a.b); }", "var a$b = 3; function f() { a$b = 5; var x = null; f(a$b); } "); [EOL] } <line_num>: 1013,1017
public void testNonWellformedAlias1() { [EOL]     testSame("var a = {b: 3}; function f() { f(x); var x = a; f(x.b); }"); [EOL] } <line_num>: 1019,1021
public void testNonWellformedAlias2() { [EOL]     testSame("var a = {b: 3}; " + "function f() { if (false) { var x = a; f(x.b); } f(x); }"); [EOL] } <line_num>: 1023,1026
public void testLocalAliasOfAncestor() { [EOL]     testSame("var a = {b: {c: 5}}; function g() { f(a); } " + "function f() { var x = a.b; f(x.c); }"); [EOL] } <line_num>: 1028,1031
public void testGlobalAliasOfAncestor() { [EOL]     testSame("var a = {b: {c: 5}}; var y = a; " + "function f() { var x = a.b; f(x.c); }"); [EOL] } <line_num>: 1033,1036
public void testLocalAliasOfOtherName() { [EOL]     testSame("var foo = function() { return {b: 3}; };" + "var a = foo(); a.b = 5; " + "function f() { var x = a.b; f(x); }"); [EOL] } <line_num>: 1038,1042
public void testLocalAliasOfFunction() { [EOL]     test("var a = function() {}; a.b = 5; " + "function f() { var x = a.b; f(x); }", "var a = function() {}; var a$b = 5; " + "function f() { var x = null; f(a$b); }"); [EOL] } <line_num>: 1044,1049
public void testNoInlineGetpropIntoCall() { [EOL]     test("var b = x; function f() { var a = b; a(); }", "var b = x; function f() { var a = null; b(); }"); [EOL]     test("var b = {}; b.c = x; function f() { var a = b.c; a(); }", "var b$c = x; function f() { var a = null; b$c(); }"); [EOL] } <line_num>: 1051,1056
public void testInlineAliasWithModifications() { [EOL]     testSame("var x = 10; function f() { var y = x; x++; alert(y)} "); [EOL]     testSame("var x = 10; function f() { var y = x; x+=1; alert(y)} "); [EOL]     test("var x = {}; x.x = 10; function f() {var y=x.x; x.x++; alert(y)}", "var x$x = 10; function f() {var y=x$x; x$x++; alert(y)}"); [EOL]     test("var x = {}; x.x = 10; function f() {var y=x.x; x.x+=1; alert(y)}", "var x$x = 10; function f() {var y=x$x; x$x+=1; alert(y)}"); [EOL] } <line_num>: 1058,1065
public void testCollapsePropertyOnExternType() { [EOL]     collapsePropertiesOnExternTypes = true; [EOL]     test("String.myFunc = function() {}; String.myFunc();", "var String$myFunc = function() {}; String$myFunc()"); [EOL] } <line_num>: 1067,1071
public void testCollapseForEachWithoutExterns() { [EOL]     collapsePropertiesOnExternTypes = true; [EOL]     test("/** @constructor */function Array(){};\n", "if (!Array.forEach) {\n" + "  Array.forEach = function() {};\n" + "}", "if (!Array$forEach) {\n" + "  var Array$forEach = function() {};\n" + "}", null, null); [EOL] } <line_num>: 1073,1082
public void testNoCollapseForEachInExterns() { [EOL]     collapsePropertiesOnExternTypes = true; [EOL]     test("/** @constructor */ function Array() {}" + "Array.forEach = function() {}", "if (!Array.forEach) {\n" + "  Array.forEach = function() {};\n" + "}", "if (!Array.forEach) {\n" + "  Array.forEach = function() {};\n" + "}", null, null); [EOL] } <line_num>: 1084,1094
public void testDoNotCollapsePropertyOnExternType() { [EOL]     collapsePropertiesOnExternTypes = false; [EOL]     test("String.myFunc = function() {}; String.myFunc()", "String.myFunc = function() {}; String.myFunc()"); [EOL] } <line_num>: 1096,1100
public void testBug1704733() { [EOL]     String prelude = "function protect(x) { return x; }" + "function O() {}" + "protect(O).m1 = function() {};" + "protect(O).m2 = function() {};" + "protect(O).m3 = function() {};"; [EOL]     testSame(prelude + "alert(O.m1); alert(O.m2()); alert(!O.m3);"); [EOL] } <line_num>: 1102,1112
public void testBug1956277() { [EOL]     test("var CONST = {}; CONST.URL = 3;", "var CONST$URL = 3;"); [EOL] } <line_num>: 1114,1117
public void testBug1974371() { [EOL]     test("/** @enum {Object} */ var Foo = {A: {c: 2}, B: {c: 3}};" + "for (var key in Foo) {}", "var Foo$A = {c: 2}; var Foo$B = {c: 3};" + "var Foo = {A: Foo$A, B: Foo$B};" + "for (var key in Foo) {}"); [EOL] } <line_num>: 1119,1126
public void testEnumOfObjects1() { [EOL]     test(COMMON_ENUM + "for (var key in Foo.A) {}", "var Foo$A = {c: 2}; var Foo$B$c = 3; for (var key in Foo$A) {}"); [EOL] } <line_num>: 1131,1136
public void testEnumOfObjects2() { [EOL]     test(COMMON_ENUM + "foo(Foo.A.c);", "var Foo$A$c = 2; var Foo$B$c = 3; foo(Foo$A$c);"); [EOL] } <line_num>: 1138,1143
public void testEnumOfObjects3() { [EOL]     test("var x = {c: 2}; var y = {c: 3};" + "/** @enum {Object} */ var Foo = {A: x, B: y};" + "for (var key in Foo) {}", "var x = {c: 2}; var y = {c: 3};" + "var Foo$A = x; var Foo$B = y; var Foo = {A: Foo$A, B: Foo$B};" + "for (var key in Foo) {}"); [EOL] } <line_num>: 1145,1153
public void testEnumOfObjects4() { [EOL]     test(COMMON_ENUM + "for (var key in Foo) {} Foo.A = 3; alert(Foo.A);", "var Foo$A = {c: 2}; var Foo$B = {c: 3};" + "var Foo = {A: Foo$A, B: Foo$B};" + "for (var key in Foo) {} Foo$A = 3; alert(Foo$A);"); [EOL] } <line_num>: 1155,1165
public void testObjectOfObjects1() { [EOL]     testSame("var Foo = {a: {c: 2}, b: {c: 3}};" + "for (var key in Foo) {} Foo.a = 3; alert(Foo.a);"); [EOL] } <line_num>: 1167,1173
public void testReferenceInAnonymousObject0() { [EOL]     test("var a = {};" + "a.b = function(){};" + "a.b.prototype.c = function(){};" + "var d = a.b.prototype.c;", "var a$b = function(){};" + "a$b.prototype.c = function(){};" + "var d = a$b.prototype.c;"); [EOL] } <line_num>: 1175,1183
public void testReferenceInAnonymousObject1() { [EOL]     test("var a = {};" + "a.b = function(){};" + "var d = a.b.prototype.c;", "var a$b = function(){};" + "var d = a$b.prototype.c;"); [EOL] } <line_num>: 1185,1191
public void testReferenceInAnonymousObject2() { [EOL]     test("var a = {};" + "a.b = function(){};" + "a.b.prototype.c = function(){};" + "var d = {c: a.b.prototype.c};", "var a$b = function(){};" + "a$b.prototype.c = function(){};" + "var d$c = a$b.prototype.c;"); [EOL] } <line_num>: 1193,1201
public void testReferenceInAnonymousObject3() { [EOL]     test("function CreateClass(a$$1) {}" + "var a = {};" + "a.b = function(){};" + "a.b.prototype.c = function(){};" + "a.d = CreateClass({c: a.b.prototype.c});", "function CreateClass(a$$1) {}" + "var a$b = function(){};" + "a$b.prototype.c = function(){};" + "var a$d = CreateClass({c: a$b.prototype.c});"); [EOL] } <line_num>: 1203,1213
public void testReferenceInAnonymousObject4() { [EOL]     test("function CreateClass(a) {}" + "var a = {};" + "a.b = CreateClass({c: function() {}});" + "a.d = CreateClass({c: a.b.c});", "function CreateClass(a$$1) {}" + "var a$b = CreateClass({c: function() {}});" + "var a$d = CreateClass({c: a$b.c});"); [EOL] } <line_num>: 1215,1223
public void testReferenceInAnonymousObject5() { [EOL]     test("function CreateClass(a) {}" + "var a = {};" + "a.b = CreateClass({c: function() {}});" + "a.d = CreateClass({c: a.b.prototype.c});", "function CreateClass(a$$1) {}" + "var a$b = CreateClass({c: function() {}});" + "var a$d = CreateClass({c: a$b.prototype.c});"); [EOL] } <line_num>: 1225,1233
public void testCrashInCommaOperator() { [EOL]     test("var a = {}; a.b = function() {},a.b();", "var a$b; a$b=function() {},a$b();"); [EOL] } <line_num>: 1235,1238
public void testCrashInNestedAssign() { [EOL]     test("var a = {}; if (a.b = function() {}) a.b();", "var a$b; if (a$b=function() {}) { a$b(); }"); [EOL] } <line_num>: 1240,1243
public void testTwinReferenceCancelsChildCollapsing() { [EOL]     test("var a = {}; if (a.b = function() {}) { a.b.c = 3; a.b(a.b.c); }", "var a$b; if (a$b = function() {}) { a$b.c = 3; a$b(a$b.c); }"); [EOL] } <line_num>: 1245,1248
public void testPropWithDollarSign() { [EOL]     test("var a = {$: 3}", "var a$$0 = 3;"); [EOL] } <line_num>: 1250,1252
public void testPropWithDollarSign2() { [EOL]     test("var a = {$: function(){}}", "var a$$0 = function(){};"); [EOL] } <line_num>: 1254,1256
public void testPropWithDollarSign3() { [EOL]     test("var a = {b: {c: 3}, b$c: function(){}}", "var a$b$c = 3; var a$b$0c = function(){};"); [EOL] } <line_num>: 1258,1261
public void testPropWithDollarSign4() { [EOL]     test("var a = {$$: {$$$: 3}};", "var a$$0$0$$0$0$0 = 3;"); [EOL] } <line_num>: 1263,1265
public void testPropWithDollarSign5() { [EOL]     test("var a = {b: {$0c: true}, b$0c: false};", "var a$b$$00c = true; var a$b$00c = false;"); [EOL] } <line_num>: 1267,1270
public void testConstKey() { [EOL]     test("var foo = {A: 3};", "var foo$A = 3;"); [EOL] } <line_num>: 1272,1274
public void testPropertyOnGlobalCtor() { [EOL]     test("/** @constructor */ function Map() {} Map.foo = 3; Map;", "function Map() {} var Map$foo = 3; Map;"); [EOL] } <line_num>: 1276,1279
public void testPropertyOnGlobalInterface() { [EOL]     test("/** @interface */ function Map() {} Map.foo = 3; Map;", "function Map() {} var Map$foo = 3; Map;"); [EOL] } <line_num>: 1281,1284
public void testPropertyOnGlobalFunction() { [EOL]     testSame("function Map() {} Map.foo = 3; Map;"); [EOL] } <line_num>: 1286,1288
public void testIssue389() { [EOL]     test("function alias() {}" + "var dojo = {};" + "dojo.gfx = {};" + "dojo.declare = function() {};" + "/** @constructor */" + "dojo.gfx.Shape = function() {};" + "dojo.gfx.Shape = dojo.declare('dojo.gfx.Shape');" + "alias(dojo);", "function alias() {}" + "var dojo = {};" + "dojo.gfx = {};" + "dojo.declare = function() {};" + "/** @constructor */" + "var dojo$gfx$Shape = function() {};" + "dojo$gfx$Shape = dojo.declare('dojo.gfx.Shape');" + "alias(dojo);", null, CollapseProperties.UNSAFE_NAMESPACE_WARNING); [EOL] } <line_num>: 1290,1310
public void testAliasedTopLevelName() { [EOL]     testSame("function alias() {}" + "var dojo = {};" + "dojo.gfx = {};" + "dojo.declare = function() {};" + "dojo.gfx.Shape = {SQUARE: 2};" + "dojo.gfx.Shape = dojo.declare('dojo.gfx.Shape');" + "alias(dojo);" + "alias(dojo$gfx$Shape$SQUARE);"); [EOL] } <line_num>: 1312,1322
public void testAliasedTopLevelEnum() { [EOL]     test("function alias() {}" + "var dojo = {};" + "dojo.gfx = {};" + "dojo.declare = function() {};" + "/** @enum {number} */" + "dojo.gfx.Shape = {SQUARE: 2};" + "dojo.gfx.Shape = dojo.declare('dojo.gfx.Shape');" + "alias(dojo);" + "alias(dojo.gfx.Shape.SQUARE);", "function alias() {}" + "var dojo = {};" + "dojo.gfx = {};" + "dojo.declare = function() {};" + "/** @constructor */" + "var dojo$gfx$Shape = {SQUARE: 2};" + "dojo$gfx$Shape = dojo.declare('dojo.gfx.Shape');" + "alias(dojo);" + "alias(dojo$gfx$Shape.SQUARE);", null, CollapseProperties.UNSAFE_NAMESPACE_WARNING); [EOL] } <line_num>: 1324,1346
public void testAssignFunctionBeforeDefinition() { [EOL]     testSame("f = function() {};" + "var f = null;"); [EOL] } <line_num>: 1348,1352
public void testObjectLitBeforeDefinition() { [EOL]     testSame("a = {b: 3};" + "var a = null;" + "this.c = a.b;"); [EOL] } <line_num>: 1354,1359
public void testTypedef1() { [EOL]     test("var foo = {};" + "/** @typedef {number} */ foo.Baz;", "var foo = {}; var foo$Baz;"); [EOL] } <line_num>: 1361,1365
public void testTypedef2() { [EOL]     test("var foo = {};" + "/** @typedef {number} */ foo.Bar.Baz;" + "foo.Bar = function() {};", "var foo$Bar$Baz; var foo$Bar = function(){};"); [EOL] } <line_num>: 1367,1372
public void testDelete1() { [EOL]     testSame("var foo = {};" + "foo.bar = 3;" + "delete foo.bar;"); [EOL] } <line_num>: 1374,1379
public void testDelete2() { [EOL]     test("var foo = {};" + "foo.bar = 3;" + "foo.baz = 3;" + "delete foo.bar;", "var foo = {};" + "foo.bar = 3;" + "var foo$baz = 3;" + "delete foo.bar;"); [EOL] } <line_num>: 1381,1391
public void testDelete3() { [EOL]     testSame("var foo = {bar: 3};" + "delete foo.bar;"); [EOL] } <line_num>: 1393,1397
public void testDelete4() { [EOL]     test("var foo = {bar: 3, baz: 3};" + "delete foo.bar;", "var foo$baz=3;var foo={bar:3};delete foo.bar"); [EOL] } <line_num>: 1399,1404
public void testDelete5() { [EOL]     test("var x = {};" + "x.foo = {};" + "x.foo.bar = 3;" + "delete x.foo.bar;", "var x$foo = {};" + "x$foo.bar = 3;" + "delete x$foo.bar;"); [EOL] } <line_num>: 1406,1415
public void testDelete6() { [EOL]     test("var x = {};" + "x.foo = {};" + "x.foo.bar = 3;" + "x.foo.baz = 3;" + "delete x.foo.bar;", "var x$foo = {};" + "x$foo.bar = 3;" + "var x$foo$baz = 3;" + "delete x$foo.bar;"); [EOL] } <line_num>: 1417,1428
public void testDelete7() { [EOL]     test("var x = {};" + "x.foo = {bar: 3};" + "delete x.foo.bar;", "var x$foo = {bar: 3};" + "delete x$foo.bar;"); [EOL] } <line_num>: 1430,1437
public void testDelete8() { [EOL]     test("var x = {};" + "x.foo = {bar: 3, baz: 3};" + "delete x.foo.bar;", "var x$foo$baz = 3; var x$foo = {bar: 3};" + "delete x$foo.bar;"); [EOL] } <line_num>: 1439,1446
public void testDelete9() { [EOL]     testSame("var x = {};" + "x.foo = {};" + "x.foo.bar = 3;" + "delete x.foo;"); [EOL] } <line_num>: 1448,1454
public void testDelete10() { [EOL]     testSame("var x = {};" + "x.foo = {bar: 3};" + "delete x.foo;"); [EOL] } <line_num>: 1456,1461
public void testDelete11() { [EOL]     test("var x = {};" + "x.foo = {};" + "/** @constructor */ x.foo.Bar = function() {};" + "delete x.foo;", "var x = {};" + "x.foo = {};" + "var x$foo$Bar = function() {};" + "delete x.foo;", null, CollapseProperties.NAMESPACE_REDEFINED_WARNING); [EOL] } <line_num>: 1463,1476
public void testPreserveConstructorDoc() { [EOL]     test("var foo = {};" + "/** @constructor */\n" + "foo.bar = function() {}", "var foo$bar = function() {}"); [EOL]     Node root = getLastCompiler().getRoot(); [EOL]     Node fooBarNode = findQualifiedNameNode("foo$bar", root); [EOL]     Node varNode = fooBarNode.getParent(); [EOL]     assertTrue(varNode.isVar()); [EOL]     assertTrue(varNode.getJSDocInfo().isConstructor()); [EOL] } <line_num>: 1478,1490
